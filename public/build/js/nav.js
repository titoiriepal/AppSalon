let paso=1;const pasoInicial=1,pasoFinal=3;let dia="";const cita={nombre:"",fecha:"",hora:"",servicios:[]};function iniciarApp(){tabs(),botonesPaginador(),siguientePagina(),anteriorPagina(),consultarAPI(),nombreCliente(),seleccionarFecha(),seleccionarHora(),mostrarResumen()}function mostrarSeccion(){document.querySelector(".mostrar").classList.remove("mostrar");document.querySelector("#paso-"+paso).classList.add("mostrar");document.querySelector(".actual").classList.remove("actual");document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function tabs(){document.querySelectorAll(".tabs button").forEach(o=>{o.addEventListener("click",(function(o){paso=parseInt(o.target.dataset.paso),mostrarSeccion(),botonesPaginador()}))})}function botonesPaginador(){const o=document.querySelector("#anterior"),e=document.querySelector("#siguiente");1===paso?(o.classList.add("ocultar"),e.classList.remove("ocultar")):3===paso?(o.classList.remove("ocultar"),e.classList.add("ocultar"),mostrarResumen()):(e.classList.remove("ocultar"),o.classList.remove("ocultar"))}function siguientePagina(){document.querySelector("#siguiente").addEventListener("click",(function(){paso<3&&(paso++,mostrarSeccion(),botonesPaginador())}))}function anteriorPagina(){document.querySelector("#anterior").addEventListener("click",(function(){paso>1&&(paso--,mostrarSeccion(),botonesPaginador())}))}async function consultarAPI(){try{const o="http://localhost:33000/api/servicios",e=await fetch(o);mostrarServicios(await e.json())}catch(o){console.log(o)}}function mostrarServicios(o){o.forEach(o=>{const{id:e,nombre:t,precio:n}=o,a=document.createElement("P");a.classList.add("nombre-servicio"),a.textContent=t;const i=document.createElement("P");i.classList.add("precio-servicio"),i.textContent=n+" €";const r=document.createElement("DIV");r.classList.add("servicio"),r.dataset.idServicio=e,r.onclick=function(){seleccionarServicio(o)},r.appendChild(a),r.appendChild(i),document.querySelector("#servicios").appendChild(r)})}function seleccionarServicio(o){const{id:e}=o,{servicios:t}=cita,n=document.querySelector(`[data-id-servicio ="${e}"]`);t.some(o=>o.id===e)?cita.servicios=t.filter(o=>o.id!==e):cita.servicios=[...t,o],n.classList.toggle("seleccionado")}function nombreCliente(){cita.nombre=document.querySelector("#nombre").value}function seleccionarFecha(){const o=document.querySelector("#fecha"),e=document.querySelector("#work-hours");o.addEventListener("input",(function(o){dia=new Date(o.target.value).getUTCDay(),[0].includes(dia)?(o.target.value="",mostrarAlerta("Cerramos Sábados por la tarde y Domingos","error",".formulario")):([6].includes(dia)?e.innerHTML='\n                <option value="09:00"></option>\n                <option value="09:15"></option>\n                <option value="09:30"></option>\n                <option value="09:45"></option>\n                <option value="10:00"></option>\n                <option value="10:15"></option>\n                <option value="10:30"></option>\n                <option value="10:45"></option>\n                <option value="11:00"></option>\n                <option value="11:15"></option>\n                <option value="11:30"></option>\n                <option value="11:45"></option>\n                <option value="12:00"></option>\n                <option value="12:15"></option>\n                <option value="12:30"></option>\n                <option value="12:45"></option>\n                <option value="13:00"></option>\n                <option value="13:15"></option>\n            ':e.innerHTML='\n                    <option value="09:00"></option>\n                    <option value="09:15"></option>\n                    <option value="09:30"></option>\n                    <option value="09:45"></option>\n                    <option value="10:00"></option>\n                    <option value="10:15"></option>\n                    <option value="10:30"></option>\n                    <option value="10:45"></option>\n                    <option value="11:00"></option>\n                    <option value="11:15"></option>\n                    <option value="11:30"></option>\n                    <option value="11:45"></option>\n                    <option value="12:00"></option>\n                    <option value="12:15"></option>\n                    <option value="12:30"></option>\n                    <option value="12:45"></option>\n                    <option value="13:00"></option>\n                    <option value="13:15"></option>\n                    <option value="16:00"></option>\n                    <option value="16:15"></option>\n                    <option value="16:30"></option>\n                    <option value="16:45"></option>\n                    <option value="17:00"></option>\n                    <option value="17:15"></option>\n                    <option value="17:30"></option>\n                    <option value="17:45"></option>\n                    <option value="18:00"></option>\n                    <option value="18:15"></option>\n                    <option value="18:30"></option>\n                    <option value="18:45"></option>\n                ',cita.fecha=o.target.value)}))}function seleccionarHora(){const o=["00","15","30","45"];document.querySelector("#hora").addEventListener("input",(function(e){const t=e.target.value,n=t.split(":")[0],a=t.split(":")[1];n<"09"||(n>="13"&&a>"15"||n>"13")&&n<"16"||n>="18"&&a>"45"||n>="19"?(mostrarAlerta("Nuestro horario es de 09 de la mañana a 13:30 y de 16:00 a 19:00 horas","error",".formulario"),e.target.value=""):o.find(o=>o===a)?[6].includes(dia)&&("13"===n&&a>"15"||n>"13")&&(mostrarAlerta("Los Sábados abrimos de 09:00 a 13:30","error",".formulario"),e.target.value=""):(mostrarAlerta("Por favor, elige una hora válida. Aquellas que acaben en 00, 15, 30 y 45","error",".formulario"),e.target.value=""),cita.hora=e.target.value}))}function mostrarAlerta(o,e,t,n=!0){const a=document.querySelector(".alerta");a&&a.remove();const i=document.createElement("DIV");i.textContent=o,i.classList.add("alerta"),i.classList.add(e);document.querySelector(t).appendChild(i),n&&setTimeout(()=>{i.remove()},4e3)}function mostrarResumen(){const o=document.querySelector(".contenido-resumen");let e=0;for(;o.firstChild;)o.removeChild(o.firstChild);if(Object.values(cita).includes("")||0===cita.servicios.length)return void mostrarAlerta("Faltan datos de servicios, fecha u hora","error",".contenido-resumen",!1);const{nombre:t,fecha:n,hora:a,servicios:i}=cita,r=new Date(n),c=r.getMonth(),s=r.getDate(),l=r.getFullYear(),u=document.createElement("P"),p=document.createElement("P"),d=document.createElement("P"),m=new Date(Date.UTC(l,c,s)).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"});u.innerHTML=" <span>Nombre:</span> "+t,p.innerHTML=" <span>Fecha:</span> "+m,d.innerHTML=` <span>Hora:</span> ${a} horas`;const v=document.createElement("H3");v.textContent="Datos de la cita",o.appendChild(v),o.appendChild(u),o.appendChild(p),o.appendChild(d);const h=document.createElement("H3");h.textContent="Resumen de Servicios",o.appendChild(h),i.forEach(t=>{const{id:n,precio:a,nombre:i}=t,r=document.createElement("DIV");r.classList.add("contenedor-servicio");const c=document.createElement("P");c.textContent=i;const s=document.createElement("P");s.innerHTML=`<span>Precio: </span>${a} €`,e+=parseInt(a),r.appendChild(c),r.appendChild(s),o.appendChild(r)});const f=document.createElement("P");f.innerHTML=`<span>Precio Total: </span> ${e}.00 €`,o.appendChild(f);const g=document.createElement("BUTTON");g.classList.add("boton"),g.textContent="Reservar Cita",g.onclick=reservarCita,o.appendChild(g)}function reservarCita(){console.log("Reservando cita")}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));